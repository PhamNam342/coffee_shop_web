<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>📊 Thống kê - Coffee Shop</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #fdf6f0; font-family: 'Segoe UI', sans-serif; }
    .sidebar { min-height: 100vh; background: linear-gradient(to bottom, #6f4e37, #3e2723); padding-top: 20px; }
    .sidebar a { color: #fff; text-decoration: none; display: block; padding: 12px 20px; font-weight: 500; border-radius: 8px; margin: 5px 10px; transition: 0.3s; }
    .sidebar a:hover { background: #8d6e63; }
    .content { padding: 25px; }
    .header { background: linear-gradient(135deg, #5d4037, #8d6e63); color: #fff; padding: 25px; border-radius: 15px; text-align: center; margin-bottom: 35px; box-shadow: 0 6px 15px rgba(0,0,0,0.2); }
    h1 { font-weight: 700; }
    h3 { margin-top: 15px; margin-bottom: 15px; color: #5d4037; font-weight: 600; }
    .card { border: none; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 25px; padding: 20px; background: #fff; }
    table thead { background-color: #5d4037; color: #fff; }
    .icon-title { display: flex; align-items: center; gap: 8px; }
    .icon-title span { font-size: 22px; }
    .bar-container { background: #fff; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.12); margin-top: 25px; }
    .footer { margin-top: 40px; text-align: center; color: #8d6e63; font-size: 14px; }
    @media (max-width:768px){ .row > .col-md-10{flex:0 0 100%; max-width:100%;} }
  </style>
</head>
<body>
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <nav class="col-md-2 d-none d-md-block sidebar">
        <div class="pt-3">
          <h5 class="text-white text-center mb-4">☕ Admin</h5>
          <a href="/admin"><i class="fa-solid fa-house me-2"></i>Dashboard</a>
          <a href="/admin/orders"><i class="fa-solid fa-receipt me-2"></i>Quản lý đơn hàng</a>
          <a href="/admin/menu"><i class="fa-solid fa-mug-saucer me-2"></i>Quản lý món</a>
          <a href="/admin/customer"><i class="fa-solid fa-user me-2"></i>Khách hàng</a>
          <a href="/admin/shift"><i class="fa-solid fa-clock me-2"></i>Ca làm</a>
          <a href="/admin/voucher"><i class="fa-solid fa-ticket me-2"></i>Voucher</a>
          <a href="/admin/employee"><i class="fa-solid fa-user-tie me-2"></i>Nhân viên</a>
          <a href="/admin/statistic"><i class="fa-solid fa-chart-line me-2"></i>Thống kê</a>
          <a href="/logout"><i class="fa-solid fa-door-open me-2"></i>Đăng xuất</a>
        </div>
      </nav>

    <!-- Main content -->
    <main class="col-md-10 ms-sm-auto col-lg-10 content">
      <div class="header">
        <h1>☕ Coffee Shop Dashboard</h1>
        <p>Thống kê lương nhân viên, khách hàng & doanh thu</p>
      </div>

      <!-- Lương nhân viên -->
      <div class="card">
        <h3 class="icon-title"><span>💰</span> Lương nhân viên (USD)</h3>
        <table class="table table-striped table-hover mt-2">
          <thead><tr><th>Tên</th><th>Số ca</th><th>Lương</th></tr></thead>
          <tbody>
            {% for e in salaries %}
            <tr>
              <td>{{ e[1] }}</td>
              <td>{{ e[2] }}</td>
              <td>{{ e[3] }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Top 10 khách -->
      <div class="card">
        <h3 class="icon-title"><span>🏆</span> Top 10 khách hàng thân thiết</h3>
        <table class="table table-striped table-hover mt-2">
          <thead><tr><th>Tên khách</th><th>Địa chỉ</th><th>SĐT</th><th>Loại KH</th><th>Tổng chi (USD)</th></tr></thead>
          <tbody>
            {% for c in top_customers %}
            <tr>
              <td>{{ c[0] }}</td>
              <td>{{ c[1] }}</td>
              <td>{{ c[2] }}</td>
              <td>{{ c[3] }}</td>
              <td>{{ c[4] }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Biểu đồ món được đặt nhiều nhất -->
      <div class="bar-container">
        <h3 class="icon-title"><span>🍹</span> Món được đặt nhiều nhất</h3>
        <canvas id="popularProductsChart"></canvas>
      </div>

      <!-- Biểu đồ doanh thu -->
      <div class="bar-container">
        <h3 class="icon-title"><span>📈</span> Doanh thu 15 ngày gần nhất</h3>
        <canvas id="revenueChart" height="100"></canvas>
      </div>

      <div class="footer">
        <p>© 2025 Nam Cohhee </p>
        <p>Contact: 0974644276 </p>
      </div>
    </main>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
<script>
  // Chart món phổ biến
  const ctx = document.getElementById("popularProductsChart").getContext("2d");
  new Chart(ctx, {
    type: "bar",
    data: {
      labels: {{ popular_products|map(attribute=0)|list|tojson }},
      datasets: [{
        label: "Số lượng đặt",
        data: {{ popular_products|map(attribute=1)|list|tojson }},
        backgroundColor: [
          "rgba(255, 99, 132, 0.7)",
          "rgba(54, 162, 235, 0.7)",
          "rgba(255, 206, 86, 0.7)",
          "rgba(75, 192, 192, 0.7)",
          "rgba(153, 102, 255, 0.7)"
        ],
        borderColor: "rgba(0,0,0,0.1)",
        borderWidth: 1,
        borderRadius: 6
      }]
    },
    options: {
      indexAxis: "y",
      responsive: true,
      plugins: {
        legend: { display: false },
        title: { display: true, text: "Top món được đặt nhiều nhất" }
      },
      scales: { x: { beginAtZero: true, ticks: { stepSize: 1 } } }
    }
  });

  // Chart doanh thu
  const revenueCtx = document.getElementById('revenueChart').getContext('2d');
  new Chart(revenueCtx, {
    type: 'bar',
    data: {
      labels: {{ revenue_last_15_days|map(attribute=0)|list|tojson }},
      datasets: [{
        label: 'Doanh thu (USD)',
        data: {{ revenue_last_15_days|map(attribute=1)|list|tojson }},
        backgroundColor: '#5d4037',
        borderRadius: 6
      }]
    },
    options: { scales: { y: { beginAtZero: true } } }
  });
</script>
</body>
</html>
